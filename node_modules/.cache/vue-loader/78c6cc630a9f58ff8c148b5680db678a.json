{"remainingRequest":"/Users/a123/githubRep/vue-virtualized/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/a123/githubRep/vue-virtualized/src/components/VueVirtualized.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/a123/githubRep/vue-virtualized/src/components/VueVirtualized.vue","mtime":1620384618678},{"path":"/Users/a123/githubRep/vue-virtualized/node_modules/cache-loader/dist/cjs.js","mtime":1618913751720},{"path":"/Users/a123/githubRep/vue-virtualized/node_modules/babel-loader/lib/index.js","mtime":1617162271907},{"path":"/Users/a123/githubRep/vue-virtualized/node_modules/cache-loader/dist/cjs.js","mtime":1618913751720},{"path":"/Users/a123/githubRep/vue-virtualized/node_modules/vue-loader/lib/index.js","mtime":1617162281281}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiVnVlVmlydGF1bGl6ZWQiLAogIHByb3BzOiB7CiAgICBzb3VyY2VMaXN0OiB7CiAgICAgIHR5cGU6IEFycmF5LAogICAgICBkZWZhdWx0OiAoKSA9PiBbXQogICAgfSwKICAgIG92ZXJzY2FuOiB7CiAgICAgIHR5cGU6IE51bWJlciwKICAgICAgZGVmYXVsdDogKCkgPT4gOAogICAgfSwKICAgIHJvd0hlaWdodDogewogICAgICB0eXBlOiBOdW1iZXIsCiAgICAgIGRlZmF1bHQ6ICgpID0+IDYwCiAgICB9CiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgc2hvd25MaXN0OiBbXSwKICAgICAgY29udGFpbmVySGVpZ2h0OiBudWxsLAogICAgICBzdGFydEluZGV4OiAwLAogICAgICBlbmRJbmRleDogMCwKICAgICAgc3RhcnRPZmZzZXQ6IDAsCiAgICAgIGVuZE9mZnNldDogMCwKICAgICAgYW5jaG9ySXRlbTogewogICAgICAgIGluZGV4OiAwLAogICAgICAgIHRvcDogMCwKICAgICAgICBib3R0b206IDAKICAgICAgfSwKICAgICAgY2FjaGU6IFtdLAogICAgICB2aXNpYmxlQ291bnQ6IDAsCiAgICAgIGRpcmVjdGlvbjogIiIKICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgZ2V0Rmlyc3RDaGFyT2ZOYW1lKCkgewogICAgICByZXR1cm4gZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICByZXR1cm4gbmFtZS5zdWJzdHIoMCwgMSk7CiAgICAgIH07CiAgICB9CiAgfSwKCiAgbW91bnRlZCgpIHsKICAgIC8vIOWIneWni+WMliBjb250YWluZXIg6auY5bqm44CB5Y+v6KeG5Yy65Z+f5bGV56S655qE5Liq5pWw44CBc3RhcnRPZmZzZXTjgIFlbmRPZmZzZXQg562J5YC8CiAgICB0aGlzLmluaXQoKTsKCiAgICBsZXQgYmVmb3JlID0gMDsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKAogICAgICAic2Nyb2xsIiwKICAgICAgKCkgPT4gewogICAgICAgIGNvbnN0IGFmdGVyID0gd2luZG93LmRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wCiAgICAgICAgICA/IHdpbmRvdy5kb2N1bWVudC5ib2R5LnNjcm9sbFRvcAogICAgICAgICAgOiB3aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcDsKCiAgICAgICAgaWYgKGFmdGVyID4gYmVmb3JlKSB7CiAgICAgICAgICBpZiAoYWZ0ZXIgPiB0aGlzLmFuY2hvckl0ZW0uYm90dG9tICYmIHRoaXMuYW5jaG9ySXRlbS5ib3R0b20pIHsKICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSAidXAiOwogICAgICAgICAgICAvLyDmm7TmlrAgc3RhcnRJbmRleOOAgWVuZEluZGV444CBc2hvd25MaXN044CBYW5jaG9ySXRlbeOAgQogICAgICAgICAgICB0aGlzLnVwZGF0ZUJvdW5kYXJ5SW5kZXgoYWZ0ZXIpOwogICAgICAgICAgICB0aGlzLnVwZGF0ZURhdGEoKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKGFmdGVyIDwgdGhpcy5hbmNob3JJdGVtLnRvcCAmJiB0aGlzLmFuY2hvckl0ZW0udG9wKSB7CiAgICAgICAgICAgIHRoaXMuZGlyZWN0aW9uID0gImRvd24iOwogICAgICAgICAgICB0aGlzLnVwZGF0ZUJvdW5kYXJ5SW5kZXgoYWZ0ZXIpOwogICAgICAgICAgICB0aGlzLnVwZGF0ZURhdGEoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYmVmb3JlID0gYWZ0ZXI7CiAgICAgIH0sCiAgICAgIGZhbHNlCiAgICApOwogIH0sCiAgbWV0aG9kczogewogICAgdXBkYXRlRGF0YSgpIHsKICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09PSAidXAiKSB7CiAgICAgICAgdGhpcy5zaG93bkxpc3Quc2hpZnQoKTsKICAgICAgICB0aGlzLnNob3duTGlzdC5wdXNoKHRoaXMuc291cmNlTGlzdFt0aGlzLmVuZEluZGV4XSk7CgogICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAgIHRoaXMuY2FjaGUuc2hpZnQoKTsKICAgICAgICAgIGNvbnN0IGVsZUxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIudnVlLXZpcnR1YWxpemVkLS1pdGVtIik7CiAgICAgICAgICB0aGlzLmNhY2hlUG9zaXRpb24oCiAgICAgICAgICAgIEFycmF5LmZyb20oZWxlTGlzdClbZWxlTGlzdC5sZW5ndGggLSAxXSwKICAgICAgICAgICAgdGhpcy5lbmRJbmRleAogICAgICAgICAgKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmRpcmVjdGlvbiA9PT0gImRvd24iKSB7CiAgICAgICAgLy8gVE9ETyDkuIvmi4nmnIkgYnVnCiAgICAgICAgdGhpcy5zaG93bkxpc3QucG9wKCk7CiAgICAgICAgdGhpcy5zaG93bkxpc3QucmV2ZXJzZSgpOwogICAgICAgIHRoaXMuc2hvd25MaXN0LnB1c2godGhpcy5zb3VyY2VMaXN0W3RoaXMuc3RhcnRJbmRleCAtIDFdKTsKICAgICAgICB0aGlzLnNob3duTGlzdC5yZXZlcnNlKCk7CgogICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAgIHRoaXMuY2FjaGUucG9wKCk7CiAgICAgICAgICBjb25zdCBlbGVMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLnZ1ZS12aXJ0dWFsaXplZC0taXRlbSIpOwogICAgICAgICAgdGhpcy5jYWNoZVBvc2l0aW9uKAogICAgICAgICAgICBBcnJheS5mcm9tKGVsZUxpc3QpWzBdLAogICAgICAgICAgICB0aGlzLnN0YXJ0SW5kZXggLSAxLAogICAgICAgICAgICBmYWxzZQogICAgICAgICAgKTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdGhpcy5zdGFydE9mZnNldCA9IHRoaXMuYW5jaG9ySXRlbS50b3A7CiAgICAgIHRoaXMuZW5kT2Zmc2V0ID0KICAgICAgICAodGhpcy5zb3VyY2VMaXN0Lmxlbmd0aCAtIHRoaXMuZW5kSW5kZXgpICogdGhpcy5yb3dIZWlnaHQ7CiAgICB9LAogICAgdXBkYXRlQm91bmRhcnlJbmRleChzY3JvbGxUb3AgPSAwKSB7CiAgICAgIGNvbnN0IGFuY2hvckl0ZW0gPSB0aGlzLmNhY2hlLmZpbmQoKGl0ZW0pID0+IHsKICAgICAgICByZXR1cm4gaXRlbS5ib3R0b20gPj0gc2Nyb2xsVG9wOwogICAgICB9KTsKCiAgICAgIGlmICghYW5jaG9ySXRlbSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5hbmNob3JJdGVtID0geyAuLi5hbmNob3JJdGVtIH07CiAgICAgIHRoaXMuc3RhcnRJbmRleCA9IHRoaXMuYW5jaG9ySXRlbS5pbmRleDsKICAgICAgdGhpcy5lbmRJbmRleCA9IHRoaXMuc3RhcnRJbmRleCArIHRoaXMudmlzaWJsZUNvdW50IC0gMTsKICAgIH0sCiAgICAvKioKICAgICAqIOe8k+WtmOWPr+inhuWMuuWfn+eahCBkYXRhCiAgICAgKi8KICAgIGNhY2hlUG9zaXRpb24obm9kZSwgaW5kZXgsIGlzVHJhaWwgPSB0cnVlKSB7CiAgICAgIGlmIChub2RlKSB7CiAgICAgICAgY29uc3QgcmVjdCA9IG5vZGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgY29uc3QgdG9wID0gcmVjdC50b3AgKyB3aW5kb3cucGFnZVlPZmZzZXQ7CgogICAgICAgIGlmIChpc1RyYWlsKSB7CiAgICAgICAgICB0aGlzLmNhY2hlLnB1c2goewogICAgICAgICAgICBpbmRleDogaW5kZXgsCiAgICAgICAgICAgIHRvcCwKICAgICAgICAgICAgYm90dG9tOiB0b3AgKyB0aGlzLnJvd0hlaWdodAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuY2FjaGUucmV2ZXJzZSgpOwogICAgICAgICAgdGhpcy5jYWNoZS5wdXNoKHsKICAgICAgICAgICAgaW5kZXg6IGluZGV4LAogICAgICAgICAgICB0b3AsCiAgICAgICAgICAgIGJvdHRvbTogdG9wICsgdGhpcy5yb3dIZWlnaHQKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5jYWNoZS5yZXZlcnNlKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgaW5pdCgpIHsKICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgIHRoaXMuY29udGFpbmVySGVpZ2h0ID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoCiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIudnVlLXZpcnR1YWxpemVkIikKICAgICAgICApLmhlaWdodDsKICAgICAgICB0aGlzLnZpc2libGVDb3VudCA9IE1hdGguY2VpbCgKICAgICAgICAgIHBhcnNlSW50KHRoaXMuY29udGFpbmVySGVpZ2h0KSAvIHRoaXMucm93SGVpZ2h0CiAgICAgICAgKTsKICAgICAgICB0aGlzLnN0YXJ0SW5kZXggPSAwOwogICAgICAgIHRoaXMuZW5kSW5kZXggPSB0aGlzLnN0YXJ0SW5kZXggKyB0aGlzLnZpc2libGVDb3VudCAtIDE7CiAgICAgICAgdGhpcy5zaG93bkxpc3QgPSB0aGlzLnNvdXJjZUxpc3Quc2xpY2UodGhpcy5zdGFydEluZGV4LCB0aGlzLmVuZEluZGV4KTsKICAgICAgICB0aGlzLnN0YXJ0T2Zmc2V0ID0gMDsKICAgICAgICB0aGlzLmVuZE9mZnNldCA9CiAgICAgICAgICAodGhpcy5zb3VyY2VMaXN0Lmxlbmd0aCAtIHRoaXMuZW5kSW5kZXgpICogdGhpcy5yb3dIZWlnaHQ7CgogICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAgIGNvbnN0IGVsZUxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIudnVlLXZpcnR1YWxpemVkLS1pdGVtIik7CiAgICAgICAgICBBcnJheS5mcm9tKGVsZUxpc3QpLm1hcCgoZWxlLCBpbmRleCkgPT4gewogICAgICAgICAgICB0aGlzLmNhY2hlUG9zaXRpb24oZWxlLCBpbmRleCk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuYW5jaG9ySXRlbSA9IHRoaXMuY2FjaGVbMF07CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0KfTsK"},{"version":3,"sources":["VueVirtualized.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAuBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"VueVirtualized.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div\n    class=\"vue-virtualized\"\n    :style=\"{ paddingTop: startOffset + 'px', paddingBottom: endOffset + 'px' }\"\n  >\n    <div\n      v-for=\"(name, index) in shownList\"\n      :key=\"index\"\n      class=\"vue-virtualized--item\"\n      :style=\"{ height: rowHeight + 'px' }\"\n    >\n      <div class=\"vue-virtualized--avatar\">\n        {{ getFirstCharOfName(name) }}\n      </div>\n      <div class=\"vue-virtualized--right\">\n        <span>{{ name }}</span>\n        <span>This is row {{ startIndex + index }}</span>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: \"VueVirtaulized\",\n  props: {\n    sourceList: {\n      type: Array,\n      default: () => []\n    },\n    overscan: {\n      type: Number,\n      default: () => 8\n    },\n    rowHeight: {\n      type: Number,\n      default: () => 60\n    }\n  },\n  data() {\n    return {\n      shownList: [],\n      containerHeight: null,\n      startIndex: 0,\n      endIndex: 0,\n      startOffset: 0,\n      endOffset: 0,\n      anchorItem: {\n        index: 0,\n        top: 0,\n        bottom: 0\n      },\n      cache: [],\n      visibleCount: 0,\n      direction: \"\"\n    };\n  },\n  computed: {\n    getFirstCharOfName() {\n      return function (name) {\n        return name.substr(0, 1);\n      };\n    }\n  },\n\n  mounted() {\n    // 初始化 container 高度、可视区域展示的个数、startOffset、endOffset 等值\n    this.init();\n\n    let before = 0;\n    window.addEventListener(\n      \"scroll\",\n      () => {\n        const after = window.document.body.scrollTop\n          ? window.document.body.scrollTop\n          : window.document.documentElement.scrollTop;\n\n        if (after > before) {\n          if (after > this.anchorItem.bottom && this.anchorItem.bottom) {\n            this.direction = \"up\";\n            // 更新 startIndex、endIndex、shownList、anchorItem、\n            this.updateBoundaryIndex(after);\n            this.updateData();\n          }\n        } else {\n          if (after < this.anchorItem.top && this.anchorItem.top) {\n            this.direction = \"down\";\n            this.updateBoundaryIndex(after);\n            this.updateData();\n          }\n        }\n        before = after;\n      },\n      false\n    );\n  },\n  methods: {\n    updateData() {\n      if (this.direction === \"up\") {\n        this.shownList.shift();\n        this.shownList.push(this.sourceList[this.endIndex]);\n\n        this.$nextTick(() => {\n          this.cache.shift();\n          const eleList = document.querySelectorAll(\".vue-virtualized--item\");\n          this.cachePosition(\n            Array.from(eleList)[eleList.length - 1],\n            this.endIndex\n          );\n        });\n      } else if (this.direction === \"down\") {\n        // TODO 下拉有 bug\n        this.shownList.pop();\n        this.shownList.reverse();\n        this.shownList.push(this.sourceList[this.startIndex - 1]);\n        this.shownList.reverse();\n\n        this.$nextTick(() => {\n          this.cache.pop();\n          const eleList = document.querySelectorAll(\".vue-virtualized--item\");\n          this.cachePosition(\n            Array.from(eleList)[0],\n            this.startIndex - 1,\n            false\n          );\n        });\n      }\n\n      this.startOffset = this.anchorItem.top;\n      this.endOffset =\n        (this.sourceList.length - this.endIndex) * this.rowHeight;\n    },\n    updateBoundaryIndex(scrollTop = 0) {\n      const anchorItem = this.cache.find((item) => {\n        return item.bottom >= scrollTop;\n      });\n\n      if (!anchorItem) {\n        return;\n      }\n\n      this.anchorItem = { ...anchorItem };\n      this.startIndex = this.anchorItem.index;\n      this.endIndex = this.startIndex + this.visibleCount - 1;\n    },\n    /**\n     * 缓存可视区域的 data\n     */\n    cachePosition(node, index, isTrail = true) {\n      if (node) {\n        const rect = node.getBoundingClientRect();\n        const top = rect.top + window.pageYOffset;\n\n        if (isTrail) {\n          this.cache.push({\n            index: index,\n            top,\n            bottom: top + this.rowHeight\n          });\n        } else {\n          this.cache.reverse();\n          this.cache.push({\n            index: index,\n            top,\n            bottom: top + this.rowHeight\n          });\n          this.cache.reverse();\n        }\n      }\n    },\n    init() {\n      this.$nextTick(() => {\n        this.containerHeight = window.getComputedStyle(\n          document.querySelector(\".vue-virtualized\")\n        ).height;\n        this.visibleCount = Math.ceil(\n          parseInt(this.containerHeight) / this.rowHeight\n        );\n        this.startIndex = 0;\n        this.endIndex = this.startIndex + this.visibleCount - 1;\n        this.shownList = this.sourceList.slice(this.startIndex, this.endIndex);\n        this.startOffset = 0;\n        this.endOffset =\n          (this.sourceList.length - this.endIndex) * this.rowHeight;\n\n        this.$nextTick(() => {\n          const eleList = document.querySelectorAll(\".vue-virtualized--item\");\n          Array.from(eleList).map((ele, index) => {\n            this.cachePosition(ele, index);\n          });\n          this.anchorItem = this.cache[0];\n        });\n      });\n    }\n  }\n};\n</script>\n\n<style scoped>\n.vue-virtualized {\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n}\n\n.vue-virtualized--item {\n  display: flex;\n  align-items: center;\n  padding-left: 15px;\n  border: 1px solid #e0e0e0;\n  border-bottom: none;\n}\n\n.vue-virtualized--item:last-child {\n  border-bottom: 1px solid #e0e0e0;\n}\n\n.vue-virtualized--avatar {\n  width: 40px;\n  height: 40px;\n  margin-right: 25px;\n  text-align: center;\n  line-height: 40px;\n  border-radius: 50%;\n  color: #fff;\n  font-size: 1.5em;\n  background: rgb(244, 67, 54);\n}\n\n.vue-virtualized--right {\n  display: flex;\n  flex-direction: column;\n}\n\nspan {\n  text-align: start;\n}\n</style>"]}]}