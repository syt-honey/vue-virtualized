{"remainingRequest":"/Users/a123/githubRep/vue-virtualized/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/a123/githubRep/vue-virtualized/src/components/VueVirtualized.vue?vue&type=style&index=0&id=153ead65&scoped=true&lang=css&","dependencies":[{"path":"/Users/a123/githubRep/vue-virtualized/src/components/VueVirtualized.vue","mtime":1620384618678},{"path":"/Users/a123/githubRep/vue-virtualized/node_modules/css-loader/dist/cjs.js","mtime":1618913753848},{"path":"/Users/a123/githubRep/vue-virtualized/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1617162281281},{"path":"/Users/a123/githubRep/vue-virtualized/node_modules/postcss-loader/src/index.js","mtime":1617162281188},{"path":"/Users/a123/githubRep/vue-virtualized/node_modules/cache-loader/dist/cjs.js","mtime":1618913751720},{"path":"/Users/a123/githubRep/vue-virtualized/node_modules/vue-loader/lib/index.js","mtime":1617162281281}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi52dWUtdmlydHVhbGl6ZWQgewogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICBoZWlnaHQ6IDEwMHZoOwp9CgoudnVlLXZpcnR1YWxpemVkLS1pdGVtIHsKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgcGFkZGluZy1sZWZ0OiAxNXB4OwogIGJvcmRlcjogMXB4IHNvbGlkICNlMGUwZTA7CiAgYm9yZGVyLWJvdHRvbTogbm9uZTsKfQoKLnZ1ZS12aXJ0dWFsaXplZC0taXRlbTpsYXN0LWNoaWxkIHsKICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2UwZTBlMDsKfQoKLnZ1ZS12aXJ0dWFsaXplZC0tYXZhdGFyIHsKICB3aWR0aDogNDBweDsKICBoZWlnaHQ6IDQwcHg7CiAgbWFyZ2luLXJpZ2h0OiAyNXB4OwogIHRleHQtYWxpZ246IGNlbnRlcjsKICBsaW5lLWhlaWdodDogNDBweDsKICBib3JkZXItcmFkaXVzOiA1MCU7CiAgY29sb3I6ICNmZmY7CiAgZm9udC1zaXplOiAxLjVlbTsKICBiYWNrZ3JvdW5kOiByZ2IoMjQ0LCA2NywgNTQpOwp9CgoudnVlLXZpcnR1YWxpemVkLS1yaWdodCB7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwp9CgpzcGFuIHsKICB0ZXh0LWFsaWduOiBzdGFydDsKfQo="},{"version":3,"sources":["VueVirtualized.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuMA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"VueVirtualized.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div\n    class=\"vue-virtualized\"\n    :style=\"{ paddingTop: startOffset + 'px', paddingBottom: endOffset + 'px' }\"\n  >\n    <div\n      v-for=\"(name, index) in shownList\"\n      :key=\"index\"\n      class=\"vue-virtualized--item\"\n      :style=\"{ height: rowHeight + 'px' }\"\n    >\n      <div class=\"vue-virtualized--avatar\">\n        {{ getFirstCharOfName(name) }}\n      </div>\n      <div class=\"vue-virtualized--right\">\n        <span>{{ name }}</span>\n        <span>This is row {{ startIndex + index }}</span>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: \"VueVirtaulized\",\n  props: {\n    sourceList: {\n      type: Array,\n      default: () => []\n    },\n    overscan: {\n      type: Number,\n      default: () => 8\n    },\n    rowHeight: {\n      type: Number,\n      default: () => 60\n    }\n  },\n  data() {\n    return {\n      shownList: [],\n      containerHeight: null,\n      startIndex: 0,\n      endIndex: 0,\n      startOffset: 0,\n      endOffset: 0,\n      anchorItem: {\n        index: 0,\n        top: 0,\n        bottom: 0\n      },\n      cache: [],\n      visibleCount: 0,\n      direction: \"\"\n    };\n  },\n  computed: {\n    getFirstCharOfName() {\n      return function (name) {\n        return name.substr(0, 1);\n      };\n    }\n  },\n\n  mounted() {\n    // 初始化 container 高度、可视区域展示的个数、startOffset、endOffset 等值\n    this.init();\n\n    let before = 0;\n    window.addEventListener(\n      \"scroll\",\n      () => {\n        const after = window.document.body.scrollTop\n          ? window.document.body.scrollTop\n          : window.document.documentElement.scrollTop;\n\n        if (after > before) {\n          if (after > this.anchorItem.bottom && this.anchorItem.bottom) {\n            this.direction = \"up\";\n            // 更新 startIndex、endIndex、shownList、anchorItem、\n            this.updateBoundaryIndex(after);\n            this.updateData();\n          }\n        } else {\n          if (after < this.anchorItem.top && this.anchorItem.top) {\n            this.direction = \"down\";\n            this.updateBoundaryIndex(after);\n            this.updateData();\n          }\n        }\n        before = after;\n      },\n      false\n    );\n  },\n  methods: {\n    updateData() {\n      if (this.direction === \"up\") {\n        this.shownList.shift();\n        this.shownList.push(this.sourceList[this.endIndex]);\n\n        this.$nextTick(() => {\n          this.cache.shift();\n          const eleList = document.querySelectorAll(\".vue-virtualized--item\");\n          this.cachePosition(\n            Array.from(eleList)[eleList.length - 1],\n            this.endIndex\n          );\n        });\n      } else if (this.direction === \"down\") {\n        // TODO 下拉有 bug\n        this.shownList.pop();\n        this.shownList.reverse();\n        this.shownList.push(this.sourceList[this.startIndex - 1]);\n        this.shownList.reverse();\n\n        this.$nextTick(() => {\n          this.cache.pop();\n          const eleList = document.querySelectorAll(\".vue-virtualized--item\");\n          this.cachePosition(\n            Array.from(eleList)[0],\n            this.startIndex - 1,\n            false\n          );\n        });\n      }\n\n      this.startOffset = this.anchorItem.top;\n      this.endOffset =\n        (this.sourceList.length - this.endIndex) * this.rowHeight;\n    },\n    updateBoundaryIndex(scrollTop = 0) {\n      const anchorItem = this.cache.find((item) => {\n        return item.bottom >= scrollTop;\n      });\n\n      if (!anchorItem) {\n        return;\n      }\n\n      this.anchorItem = { ...anchorItem };\n      this.startIndex = this.anchorItem.index;\n      this.endIndex = this.startIndex + this.visibleCount - 1;\n    },\n    /**\n     * 缓存可视区域的 data\n     */\n    cachePosition(node, index, isTrail = true) {\n      if (node) {\n        const rect = node.getBoundingClientRect();\n        const top = rect.top + window.pageYOffset;\n\n        if (isTrail) {\n          this.cache.push({\n            index: index,\n            top,\n            bottom: top + this.rowHeight\n          });\n        } else {\n          this.cache.reverse();\n          this.cache.push({\n            index: index,\n            top,\n            bottom: top + this.rowHeight\n          });\n          this.cache.reverse();\n        }\n      }\n    },\n    init() {\n      this.$nextTick(() => {\n        this.containerHeight = window.getComputedStyle(\n          document.querySelector(\".vue-virtualized\")\n        ).height;\n        this.visibleCount = Math.ceil(\n          parseInt(this.containerHeight) / this.rowHeight\n        );\n        this.startIndex = 0;\n        this.endIndex = this.startIndex + this.visibleCount - 1;\n        this.shownList = this.sourceList.slice(this.startIndex, this.endIndex);\n        this.startOffset = 0;\n        this.endOffset =\n          (this.sourceList.length - this.endIndex) * this.rowHeight;\n\n        this.$nextTick(() => {\n          const eleList = document.querySelectorAll(\".vue-virtualized--item\");\n          Array.from(eleList).map((ele, index) => {\n            this.cachePosition(ele, index);\n          });\n          this.anchorItem = this.cache[0];\n        });\n      });\n    }\n  }\n};\n</script>\n\n<style scoped>\n.vue-virtualized {\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n}\n\n.vue-virtualized--item {\n  display: flex;\n  align-items: center;\n  padding-left: 15px;\n  border: 1px solid #e0e0e0;\n  border-bottom: none;\n}\n\n.vue-virtualized--item:last-child {\n  border-bottom: 1px solid #e0e0e0;\n}\n\n.vue-virtualized--avatar {\n  width: 40px;\n  height: 40px;\n  margin-right: 25px;\n  text-align: center;\n  line-height: 40px;\n  border-radius: 50%;\n  color: #fff;\n  font-size: 1.5em;\n  background: rgb(244, 67, 54);\n}\n\n.vue-virtualized--right {\n  display: flex;\n  flex-direction: column;\n}\n\nspan {\n  text-align: start;\n}\n</style>"]}]}